# ðŸ’š CorazÃ³n del Ahorro Grupal â€” DeclaraciÃ³n institucional

1. **Cualquier usuario puede crear un grupo y ser administrador.**
2. **Un administrador puede pertenecer a mÃºltiples grupos, como admin o participante.**
3. **Solo el administrador puede ingresar, editar o grabar:**
   - Participantes
   - DepÃ³sitos
   - Metas
4. **Los participantes solo pueden:**
   - Ver los grupos donde participan
   - Ver a sus compaÃ±eros y su progreso
   - No pueden editar, ingresar ni borrar nada

ðŸ” Esta lÃ³gica es la base de las polÃ­ticas RLS, los endpoints Express y la UI condicional.



# ðŸ§© Comparativa institucional â€” Archivos y Tablas del mÃ³dulo Ahorro Grupal

| Elemento              | Tipo      | Estado tÃ©cnico        | AcciÃ³n recomendada        | Observaciones clave                                      |
|-----------------------|-----------|------------------------|---------------------------|----------------------------------------------------------|
| AhorroGrupal.tsx      | Frontend  | Parcial (sin Supabase) | âœ… Adaptar y conservar     | LÃ³gica de cÃ¡lculo sÃ³lida, falta persistencia en Supabase |
| CrearGrupo.tsx        | Frontend  | Parcial (tabla obsoleta) | âš ï¸ Migrar o fusionar       | Usa `grupos`, debe migrar a `grupos_ahorro`              |
| PanelGrupo.tsx        | Frontend  | Parcial (tabla obsoleta) | âš ï¸ Migrar y extender       | Buena base institucional, falta compaÃ±eros y aportes     |
| VistaGrupal.tsx       | Frontend  | âœ… Completo             | âœ… Conservar               | Visual colaborativa lista para producciÃ³n                |
| VistaParticipante.tsx | Frontend  | Prototipo local        | âš ï¸ Evaluar integraciÃ³n     | Ãštil para simulador o diagnÃ³stico, no conectado aÃºn      |
| grupos_ahorro         | Tabla     | âœ… Validada con RLS     | âœ… Conservar               | Estructura oficial para grupos                           |
| aportes_grupales      | Tabla     | âœ… Validada con RLS     | âœ… Conservar               | Registra aportes individuales                           |
| participantes_grupo   | Tabla     | âœ… Validada con RLS     | âœ… Conservar               | RelaciÃ³n usuario-grupo con roles                         |
| vista_grupal          | Vista     | âš ï¸ Sin RLS              | âœ… Conservar (filtrar en frontend) | Muestra compaÃ±eros y aportes por grupo         |
| vista_mis_grupos      | Vista     | âš ï¸ Sin RLS              | âœ… Conservar (filtrar en frontend) | Muestra grupos del usuario actual              |
| grupos (obsoleta)     | Tabla     | âŒ No existe en Supabase | âŒ Eliminar o migrar       | Usada en archivos antiguos, no forma parte del sistema   |


ðŸ§© Plan de trabajo con Supabase (previo a adaptar archivos)
1. Validar estructura actual
[x] Tablas: grupos_ahorro, aportes_grupales, participantes_grupo

[x] Vistas: vista_grupal, vista_mis_grupos

[x] PolÃ­ticas RLS activas y documentadas

2. Migrar lÃ³gica de archivos obsoletos
[ ] Reemplazar referencias a grupos por grupos_ahorro

[ ] Crear inserciones en participantes_grupo al crear grupo

[ ] Confirmar que usuario_id se obtiene desde auth.uid() en todas las inserciones

3. Endpoints Express necesarios
[ ] POST /crear-grupo: inserta en grupos_ahorro y participantes_grupo

[ ] GET /mis-grupos: consulta vista_mis_grupos por auth.uid()

[ ] GET /grupo/:id: consulta vista_grupal por grupo_id

[ ] POST /aportar: inserta en aportes_grupales con validaciÃ³n de pertenencia

4. Validar relaciones y consistencia
[ ] Confirmar que grupo_id en aportes_grupales y participantes_grupo corresponde a grupos_ahorro.id

[ ] Confirmar que usuario_id en todas las tablas es uuid y se alinea con auth.users

5. SimulaciÃ³n y pruebas
[ ] Crear grupo desde Supabase UI

[ ] Agregar participantes manualmente

[ ] Insertar aportes y validar vistas



ðŸ§© Plan maestro â€” InstitucionalizaciÃ³n Supabase (Ahorro Grupal)
Paso	Objetivo tÃ©cnico	Resultado esperado
1ï¸âƒ£	Validar estructura de tablas y relaciones	Confirmar consistencia entre claves y tipos :OK
2ï¸âƒ£	Crear endpoint /crear-grupo	Insertar en grupos_ahorro y participantes_grupo:  
3ï¸âƒ£	Crear endpoint /aportar	Insertar en aportes_grupales con validaciÃ³n
4ï¸âƒ£	Crear endpoint /mis-grupos	Consultar vista_mis_grupos por auth.uid()
5ï¸âƒ£	Crear endpoint /grupo/:id	Consultar vista_grupal por grupo_id
6ï¸âƒ£	Validar seguridad y RLS	Confirmar que cada acciÃ³n respeta las polÃ­ticas
7ï¸âƒ£	Adaptar archivos visuales	Conectar componentes React con endpoints
8ï¸âƒ£	Documentar milestone tÃ©cnico	Consolidar todo en estadoConstruccionFinedu.md




ðŸ§© Milestone tÃ©cnico â€” AdaptaciÃ³n visual: AhorroGrupal.tsx
ðŸ“¦ Archivo adaptado
AhorroGrupal.tsx Componente React que permite crear un grupo de ahorro con proyecciÃ³n financiera colaborativa.

ðŸ”„ Antes
Calculaba proyecciÃ³n localmente (monto final, fecha estimada)

No persistÃ­a datos en Supabase

Agregaba correos sin vinculaciÃ³n institucional

âœ… DespuÃ©s
Conectado al endpoint Express POST /crear-grupo

Inserta en grupos_ahorro con trazabilidad completa

Registra automÃ¡ticamente al creador como admin en participantes_grupo

EnvÃ­a JWT en el header para validaciÃ³n segura (Authorization: Bearer token)

Listo para extender con mÃ¡s participantes en fase 2

ðŸ” Seguridad validada
El backend valida auth.uid() antes de insertar

RLS activa en grupos_ahorro y participantes_grupo

No se expone lÃ³gica sensible en el frontend

ðŸ§© Flujo institucional consolidado
mermaid
graph TD
  A[Usuario crea grupo en AhorroGrupal.tsx] --> B[POST /crear-grupo]
  B --> C[Insertar en grupos_ahorro]
  B --> D[Insertar en participantes_grupo (rol: admin)]
  C --> E[Grupo institucional creado]
  D --> F[Usuario vinculado como administrador]
ðŸ“ Archivos involucrados
AhorroGrupal.tsx (adaptado)

routes/grupo.js â†’ endpoint /crear-grupo

middlewareAuth.js â†’ extracciÃ³n de auth.uid() y correo

Supabase: tablas grupos_ahorro, participantes_grupo





# ðŸ§© Milestone tÃ©cnico â€” MÃ³dulo Ahorro Grupal

## ðŸŽ¯ PropÃ³sito
Institucionalizar el flujo de ahorro colaborativo entre usuarios, con trazabilidad, seguridad y visualizaciÃ³n grupal. El mÃ³dulo permite crear grupos, registrar aportes, simular metas y visualizar el progreso colectivo.

---

## ðŸ§± Estructura Supabase

### Tablas
- `grupos_ahorro`: define el grupo, meta, plazo, tipo y administrador
- `participantes_grupo`: vincula usuarios al grupo con rol (`admin`, `miembro`)
- `aportes_grupales`: registra aportes individuales con fecha y monto

### Vistas
- `vista_mis_grupos`: muestra los grupos donde participa el usuario
- `vista_grupal`: muestra el progreso de cada participante en un grupo

---

## ðŸ” Seguridad y RLS

| Tabla/Vista             | RLS activa | ObservaciÃ³n clave                                 |
|-------------------------|------------|--------------------------------------------------|
| `grupos_ahorro`         | âœ…         | Solo el admin puede modificar su grupo           |
| `participantes_grupo`   | âœ…         | Visibilidad por grupo y rol                      |
| `aportes_grupales`      | âœ…         | Cada usuario gestiona sus propios aportes        |
| `vista_mis_grupos`      | âš ï¸         | Filtrada en backend por `auth.uid()`             |
| `vista_grupal`          | âš ï¸         | Filtrada en backend por `grupo_id`               |

---

## ðŸ”Œ Endpoints Express

| Endpoint           | AcciÃ³n Supabase         | Seguridad validada | Estado |
|--------------------|-------------------------|---------------------|--------|
| `POST /crear-grupo`| Inserta en `grupos_ahorro` y `participantes_grupo` | âœ… JWT + RLS         | âœ… Listo |
| `POST /aportar`    | Inserta en `aportes_grupales`                      | âœ… JWT + RLS         | âœ… Listo |
| `GET /mis-grupos`  | Consulta `vista_mis_grupos`                        | âœ… Filtrado backend  | âœ… Listo |
| `GET /grupo/:id`   | Consulta `vista_grupal`                            | âœ… Filtrado backend  | âœ… Listo |

---

## ðŸŽ¨ Archivos visuales adaptados

| Archivo visual         | Estado tÃ©cnico        | Endpoint conectado         | Resultado esperado                          |
|------------------------|------------------------|-----------------------------|---------------------------------------------|
| `AhorroGrupal.tsx`     | âœ… Adaptado             | `POST /crear-grupo`         | Crea grupo y vincula al creador como admin  |
| `VistaGrupal.tsx`      | âœ… Adaptado             | `GET /mis-grupos`           | Muestra todos los grupos del usuario        |
| `PanelGrupo.tsx`       | âœ… Adaptado             | `GET /grupo/:id`            | Muestra detalle colaborativo del grupo      |
| `VistaParticipante.tsx`| âš ï¸ Listo para integrar  | (opcional: simulador)       | DiagnÃ³stico financiero previo al compromiso |

---

## ðŸ§  Flujo institucional consolidado

```mermaid
graph TD
  A[Usuario crea grupo en AhorroGrupal.tsx] --> B[POST /crear-grupo]
  B --> C[Insertar en grupos_ahorro]
  B --> D[Insertar en participantes_grupo (rol: admin)]
  C --> E[Grupo institucional creado]
  D --> F[Usuario vinculado como administrador]
  G[Usuario aporta en VistaGrupal.tsx] --> H[POST /aportar]
  H --> I[Insertar en aportes_grupales]
  J[VistaGrupal.tsx] --> K[GET /mis-grupos]
  L[PanelGrupo.tsx] --> M[GET /grupo/:id]







